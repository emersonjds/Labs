{"version":3,"sources":["useFormControl.tsx"],"names":["React","useId","omit","ariaAttr","FormControlContext","createContext","useFormControlProvider","props","nativeID","idProp","isRequired","isInvalid","isDisabled","isReadOnly","htmlProps","id","labelId","feedbackId","helpTextId","hasFeedbackText","setHasFeedbackText","useState","hasHelpText","setHasHelpText","context","useFormControl","field","useFormControlContext","describedBy","push","ariaDescribedBy","join","cleanProps","disabled","readOnly","required","accessibilityInvalid","accessibilityRequired","accessibilityReadOnly","accessibilityDescribedBy","undefined","useContext"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useId } from '@react-native-aria/utils';\nimport omit from 'lodash.omit';\nimport type { IFormControlProps } from './types';\nimport { ariaAttr } from '../../../utils';\n\nexport type IFormControlContext = Omit<\n  ReturnType<typeof useFormControlProvider>,\n  'htmlProps'\n>;\n\nexport const FormControlContext = React.createContext({});\n\nexport function useFormControlProvider(props: IFormControlProps) {\n  const {\n    nativeID: idProp,\n    isRequired,\n    isInvalid,\n    isDisabled,\n    isReadOnly,\n    ...htmlProps\n  } = props;\n\n  const id = useId();\n  // Generate all the required ids\n  const nativeID = idProp || `field-${id}`;\n\n  const labelId = `${nativeID}-label`;\n  const feedbackId = `${nativeID}-feedback`;\n  const helpTextId = `${nativeID}-helptext`;\n\n  /**\n   * Track whether the `FormErrorMessage` has been rendered.\n   * We use this to append its id the the `aria-describedby` of the `input`.\n   */\n  const [hasFeedbackText, setHasFeedbackText] = React.useState(false);\n\n  /**\n   * Track whether the `FormHelperText` has been rendered.\n   * We use this to append its id the the `aria-describedby` of the `input`.\n   */\n  const [hasHelpText, setHasHelpText] = React.useState(false);\n\n  const context = {\n    isRequired: !!isRequired,\n    isInvalid: !!isInvalid,\n    isReadOnly: !!isReadOnly,\n    isDisabled: !!isDisabled,\n    hasFeedbackText,\n    setHasFeedbackText,\n    hasHelpText,\n    setHasHelpText,\n    nativeID,\n    labelId,\n    feedbackId,\n    helpTextId,\n    htmlProps,\n  };\n\n  return context;\n}\n\n/**\n * React hook that provides the props that should be spread on to\n * input fields (`input`, `select`, `textarea`, etc.).\n *\n * It provides a convenient way to control a form fields, validation\n * and helper text.\n */\nexport function useFormControl(props: IFormControlProps) {\n  const field = useFormControlContext();\n  const describedBy: any[] = [];\n\n  // Error message must be described first in all scenarios.\n  if (field?.hasFeedbackText) describedBy.push(field?.feedbackId);\n  if (field?.hasHelpText) describedBy.push(field?.helpTextId);\n  const ariaDescribedBy = describedBy.join(' ');\n\n  const cleanProps = omit(props, [\n    'isInvalid',\n    'isDisabled',\n    'isReadOnly',\n    'isRequired',\n  ]);\n\n  return {\n    ...cleanProps,\n    nativeID: props.nativeID ?? field?.nativeID,\n    disabled: props.isDisabled || field?.isDisabled,\n    readOnly: props.isReadOnly || field?.isReadOnly,\n    required: props.isRequired || field?.isRequired,\n    accessibilityInvalid: ariaAttr(props.isInvalid || field?.isInvalid),\n    accessibilityRequired: ariaAttr(props.isRequired || field?.isRequired),\n    accessibilityReadOnly: ariaAttr(props.isReadOnly || field?.isReadOnly),\n    accessibilityDescribedBy: ariaDescribedBy || undefined,\n  };\n}\n\nexport const useFormControlContext = () => {\n  return (React.useContext(\n    FormControlContext\n  ) as unknown) as IFormControlContext;\n};\n"]}