{"version":3,"sources":["Typeahead.tsx"],"names":["React","useButton","useComboBoxState","useComboBox","useListBox","useOption","ScrollView","findNodeHandle","Platform","Item","Box","Pressable","Text","extractInObject","layoutPropsList","Input","useThemeProps","useHasResponsiveProps","Typeahead","forwardRef","onSelectedItemChange","options","renderItem","getOptionLabel","getOptionKey","onChange","numberOfItems","rest","ref","undefined","slice","item","Error","id","optionLabel","optionKey","ComboBoxImplementation","props","layoutProps","state","triggerRef","useRef","inputRef","listBoxRef","popoverRef","buttonProps","triggerProps","inputProps","listBoxProps","labelProps","buttonRef","menuTrigger","toggleIconSetter","toggleIcon","isOpen","label","ListBoxPopup","dropdownHeight","autoFocus","focusStrategy","disallowEmptySelection","node","OS","current","collection","map","key","Option","searchItemStyle","isDisabled","disabledKeys","has","isSelected","selectionManager","isFocused","focusedKey","optionProps","shouldFocusOnHover","shouldUseVirtualFocus","backgroundColor","opacity","_focus","_disabled","rendered"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useButton } from '@react-native-aria/button';\nimport { ComboBoxState, useComboBoxState } from '@react-stately/combobox';\nimport { useComboBox } from '@react-native-aria/combobox';\nimport { useListBox, useOption } from '@react-native-aria/listbox';\nimport { ScrollView, findNodeHandle, Platform } from 'react-native';\nimport { Item } from '@react-stately/collections';\nimport Box from '../../primitives/Box';\nimport { Pressable } from '../../primitives/Pressable';\nimport Text from '../../primitives/Text';\nimport { extractInObject } from '../../../theme/tools';\nimport { ITypeaheadProps, IComboBoxProps, layoutPropsList } from './types';\nimport { Input } from '../../primitives/Input';\nimport { useThemeProps } from '../../../hooks';\nimport { useHasResponsiveProps } from '../../../hooks/useHasResponsiveProps';\n\nexport const Typeahead = React.forwardRef(\n  (\n    {\n      onSelectedItemChange,\n      options,\n      renderItem,\n      getOptionLabel,\n      getOptionKey,\n      onChange,\n      numberOfItems,\n      ...rest\n    }: ITypeaheadProps,\n    ref?: any\n  ) => {\n    //TODO: refactor for responsive prop\n    if (useHasResponsiveProps(rest)) {\n      return null;\n    }\n    return (\n      <ComboBoxImplementation\n        {...rest}\n        onSelectionChange={onSelectedItemChange}\n        items={\n          numberOfItems !== undefined\n            ? options.slice(0, numberOfItems)\n            : options\n        }\n        onInputChange={onChange}\n        ref={ref}\n      >\n        {(item: any) => {\n          if (typeof item !== 'string' && getOptionLabel === undefined) {\n            throw new Error('Please use getOptionLabel prop');\n          }\n\n          if (item.id === undefined && getOptionKey === undefined) {\n            throw new Error('Please use getOptionKey prop');\n          }\n\n          const optionLabel = getOptionLabel ? getOptionLabel(item) : item;\n          const optionKey = getOptionKey\n            ? getOptionKey(item)\n            : item.id !== undefined\n            ? item.id\n            : optionLabel;\n\n          return (\n            <Item textValue={optionLabel} key={optionKey}>\n              {renderItem ? (\n                renderItem(item)\n              ) : (\n                <Box p={2} justifyContent=\"center\">\n                  <Text>{optionLabel}</Text>\n                </Box>\n              )}\n            </Item>\n          );\n        }}\n      </ComboBoxImplementation>\n    );\n  }\n);\n\nconst ComboBoxImplementation = React.forwardRef(\n  (props: IComboBoxProps, ref?: any) => {\n    const [layoutProps] = extractInObject(props, layoutPropsList);\n    let state = useComboBoxState(props);\n\n    let triggerRef = React.useRef(null);\n    let inputRef = React.useRef(null);\n    let listBoxRef = React.useRef(null);\n    let popoverRef = React.useRef(null);\n\n    let {\n      buttonProps: triggerProps,\n      inputProps,\n      listBoxProps,\n      labelProps,\n    } = useComboBox(\n      {\n        ...props,\n        inputRef,\n        buttonRef: triggerRef,\n        listBoxRef,\n        popoverRef,\n        menuTrigger: 'input',\n      },\n      state\n    );\n\n    const toggleIconSetter = () => {\n      if (typeof props.toggleIcon === 'function')\n        return props.toggleIcon({\n          isOpen: state.isOpen,\n        });\n      return props.toggleIcon;\n    };\n\n    let { buttonProps } = useButton(triggerProps);\n\n    return (\n      <Box flexDirection=\"row\" {...layoutProps} ref={ref}>\n        <Box flex={1}>\n          {props.label && (\n            <Text {...labelProps} pb={1}>\n              {props.label}\n            </Text>\n          )}\n          <Input\n            {...inputProps}\n            ref={inputRef}\n            InputRightElement={\n              // @ts-ignore - RN has hitSlop type inconsistent for View and Pressable!\n              <Pressable {...buttonProps} ref={triggerRef}>\n                {toggleIconSetter()}\n              </Pressable>\n            }\n          />\n\n          {state.isOpen && (\n            <ListBoxPopup\n              {...listBoxProps}\n              listBoxRef={listBoxRef}\n              popoverRef={popoverRef}\n              state={state}\n              label={props.label}\n            />\n          )}\n        </Box>\n      </Box>\n    );\n  }\n);\n\ntype IListBoxProps = {\n  popoverRef: any;\n  listBoxRef: any;\n  state: ComboBoxState<any>;\n  dropdownHeight: number;\n  label: string;\n};\n\nfunction ListBoxPopup(props: IListBoxProps) {\n  let { popoverRef, listBoxRef, state, dropdownHeight, label } = props;\n\n  let { listBoxProps } = useListBox(\n    {\n      label,\n      autoFocus: state.focusStrategy,\n      disallowEmptySelection: true,\n    },\n    state,\n    listBoxRef\n  );\n\n  return (\n    <Box ref={popoverRef}>\n      <Box position=\"absolute\" width=\"100%\" maxHeight={dropdownHeight ?? 200}>\n        <ScrollView\n          {...listBoxProps}\n          keyboardShouldPersistTaps=\"handled\"\n          ref={(node) => {\n            if (Platform.OS === 'web') {\n              listBoxRef.current = findNodeHandle(node);\n            } else {\n              listBoxRef.current = node;\n            }\n          }}\n        >\n          {[...state.collection].map((item) => (\n            <Option key={item.key} item={item} state={state} />\n          ))}\n        </ScrollView>\n      </Box>\n    </Box>\n  );\n}\n\nfunction Option({ item, state }: { item: any; state: ComboBoxState<any> }) {\n  const searchItemStyle = useThemeProps('TypeAheadSearchItem', {});\n\n  let ref = React.useRef(null);\n  let isDisabled = state.disabledKeys.has(item.key);\n  let isSelected = state.selectionManager.isSelected(item.key);\n  let isFocused = state.selectionManager.focusedKey === item.key;\n\n  let { optionProps } = useOption(\n    {\n      key: item.key,\n      isDisabled,\n      isSelected,\n      shouldFocusOnHover: true,\n      shouldUseVirtualFocus: true,\n    },\n    state,\n    ref\n  );\n\n  let backgroundColor = searchItemStyle.backgroundColor;\n  let opacity = 1;\n\n  if (isSelected) {\n    backgroundColor = searchItemStyle._focus.backgroundColor;\n  } else if (isFocused) {\n    backgroundColor = searchItemStyle._focus.backgroundColor;\n  } else if (isDisabled) {\n    opacity = 0.6;\n    backgroundColor = searchItemStyle._disabled.backgroundColor;\n  }\n\n  return (\n    <Pressable\n      {...optionProps}\n      opacity={opacity}\n      cursor={\n        isDisabled ? (Platform.OS === 'web' ? 'not-allowed' : null) : null\n      }\n      backgroundColor={backgroundColor}\n      ref={ref}\n    >\n      {item.rendered}\n    </Pressable>\n  );\n}\n"]}