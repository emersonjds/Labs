{"version":3,"sources":["Transition.tsx"],"names":["React","forwardRef","Animated","transformStylesMap","translateY","translateX","scale","scaleX","scaleY","rotate","defaultStyles","opacity","getAnimatedStyles","animateValue","initial","to","styles","transform","key","push","interpolate","inputRange","outputRange","defaultTransitionConfig","type","useNativeDriver","duration","delay","Transition","children","onTransitionComplete","visible","animate","exit","style","as","rest","ref","useRef","Value","current","Component","useMemo","createAnimatedComponent","View","animationState","setAnimationState","useState","prevVisible","useEffect","entryTransition","transition","exitTransition","startAnimation","sequence","toValue","start","initialState","animateState"],"mappings":";;AAAA;AACA,OAAOA,KAAP,IAAgBC,UAAhB,QAAkC,OAAlC;AACA,SAASC,QAAT,QAAyB,cAAzB;AAOA,MAAMC,kBAAkB,GAAG;AACzBC,EAAAA,UAAU,EAAE,IADa;AAEzBC,EAAAA,UAAU,EAAE,IAFa;AAGzBC,EAAAA,KAAK,EAAE,IAHkB;AAIzBC,EAAAA,MAAM,EAAE,IAJiB;AAKzBC,EAAAA,MAAM,EAAE,IALiB;AAMzBC,EAAAA,MAAM,EAAE;AANiB,CAA3B;AASA,MAAMC,aAAa,GAAG;AACpBC,EAAAA,OAAO,EAAE,CADW;AAEpBP,EAAAA,UAAU,EAAE,CAFQ;AAGpBC,EAAAA,UAAU,EAAE,CAHQ;AAIpBC,EAAAA,KAAK,EAAE,CAJa;AAKpBC,EAAAA,MAAM,EAAE,CALY;AAMpBC,EAAAA,MAAM,EAAE,CANY;AAOpBC,EAAAA,MAAM,EAAE;AAPY,CAAtB;;AAUA,MAAMG,iBAAiB,GAAIC,YAAD,IAAuB,CAC/CC,OAD+C,EAE/CC,EAF+C,KAG5C;AACH,QAAMC,MAAW,GAAG;AAClBC,IAAAA,SAAS,EAAE;AADO,GAApB;;AAGA,OAAK,IAAIC,GAAT,IAAgBJ,OAAhB,EAAyB;AACvB,QAAII,GAAG,KAAK,YAAZ,EAA0B;AACxB;AACD;;AAED,QAAIA,GAAG,IAAIf,kBAAX,EAA+B;AAAA;;AAC7B,2BAAAa,MAAM,CAACC,SAAP,wEAAkBE,IAAlB,CAAuB;AACrB,SAACD,GAAD,GAAOL,YAAY,CAACO,WAAb,CAAyB;AAC9BC,UAAAA,UAAU,EAAE,CAAC,CAAD,EAAI,CAAJ,CADkB;AAE9BC,UAAAA,WAAW,EAAE,CAAER,OAAD,CAAiBI,GAAjB,CAAD,EAAyBH,EAAD,CAAYG,GAAZ,CAAxB;AAFiB,SAAzB;AADc,OAAvB;AAMD,KAPD,MAOO;AACLF,MAAAA,MAAM,CAACE,GAAD,CAAN,GAAcL,YAAY,CAACO,WAAb,CAAyB;AACrCC,QAAAA,UAAU,EAAE,CAAC,CAAD,EAAI,CAAJ,CADyB;AAErCC,QAAAA,WAAW,EAAE,CAAER,OAAD,CAAiBI,GAAjB,CAAD,EAAyBH,EAAD,CAAYG,GAAZ,CAAxB;AAFwB,OAAzB,CAAd;AAID;AACF;;AAED,SAAOF,MAAP;AACD,CA5BD;;AA8BA,MAAMO,uBAA0C,GAAG;AACjDC,EAAAA,IAAI,EAAE,QAD2C;AAEjDC,EAAAA,eAAe,EAAE,IAFgC;AAGjDC,EAAAA,QAAQ,EAAE,GAHuC;AAIjDC,EAAAA,KAAK,EAAE;AAJ0C,CAAnD;AAOA,OAAO,MAAMC,UAAU,gBAAG3B,UAAU,CAClC,CACE;AACE4B,EAAAA,QADF;AAEEC,EAAAA,oBAFF;AAGEC,EAAAA,OAAO,GAAG,KAHZ;AAIEjB,EAAAA,OAJF;AAKEkB,EAAAA,OALF;AAMEC,EAAAA,IANF;AAOEC,EAAAA,KAPF;AAQEC,EAAAA,EARF;AASE,KAAGC;AATL,CADF,EAYEC,GAZF,KAaK;AACH,QAAMxB,YAAY,GAAGb,KAAK,CAACsC,MAAN,CAAa,IAAIpC,QAAQ,CAACqC,KAAb,CAAmB,CAAnB,CAAb,EAAoCC,OAAzD;AAEA,QAAMC,SAAS,GAAGzC,KAAK,CAAC0C,OAAN,CAAc,MAAM;AACpC,QAAIP,EAAJ,EAAQ;AACN,aAAOjC,QAAQ,CAACyC,uBAAT,CAAiCR,EAAjC,CAAP;AACD;;AACD,WAAOjC,QAAQ,CAAC0C,IAAhB;AACD,GALiB,EAKf,CAACT,EAAD,CALe,CAAlB;AAOA,QAAM,CAACU,cAAD,EAAiBC,iBAAjB,IAAsC9C,KAAK,CAAC+C,QAAN,CAAe,EAAf,CAA5C;AAEA,QAAMC,WAAW,GAAGhD,KAAK,CAACsC,MAAN,CAAaP,OAAb,CAApB;AAEA/B,EAAAA,KAAK,CAACiD,SAAN,CAAgB,MAAM;AACpB,QAAIJ,cAAc,KAAK,UAAnB,IAAiCA,cAAc,KAAK,SAAxD,EAAmE;AAAA;;AACjE,YAAMK,eAAe,GAAG,EACtB,GAAG3B,uBADmB;AAEtB,YAAGS,OAAH,aAAGA,OAAH,uBAAGA,OAAO,CAAEmB,UAAZ;AAFsB,OAAxB;AAIA,YAAMC,cAAc,GAAG,EACrB,GAAG7B,uBADkB;AAErB,YAAGU,IAAH,aAAGA,IAAH,uBAAGA,IAAI,CAAEkB,UAAT;AAFqB,OAAvB;AAKA,YAAME,cAAc,GAAGR,cAAc,KAAK,UAAnB,GAAgC,CAAhC,GAAoC,CAA3D;AAEA,YAAMM,UAAU,GAAGE,cAAc,GAAGH,eAAH,GAAqBE,cAAtD;AAEAlD,MAAAA,QAAQ,CAACoD,QAAT,CAAkB,CAChB;AACApD,MAAAA,QAAQ,CAACyB,KAAT,CAAewB,UAAU,CAACxB,KAA1B,CAFgB,EAGhBzB,QAAQ,qBAACiD,UAAU,CAAC3B,IAAZ,+DAAoB,QAApB,CAAR,CAAsCX,YAAtC,EAAoD;AAClD0C,QAAAA,OAAO,EAAEF,cADyC;AAElD5B,QAAAA,eAAe,EAAE,IAFiC;AAGlD,WAAG0B;AAH+C,OAApD,CAHgB,CAAlB,EAQGK,KARH,CAQS,MAAM;AACb,YAAIX,cAAc,KAAK,UAAvB,EAAmC;AACjCC,UAAAA,iBAAiB,CAAC,SAAD,CAAjB;AACD,SAFD,MAEO,IAAID,cAAc,KAAK,SAAvB,EAAkC;AACvCC,UAAAA,iBAAiB,CAAC,QAAD,CAAjB;AACD;AACF,OAdD,EAdiE,CA6BjE;AACD;;AAED,QAAID,cAAc,KAAK,QAAvB,EAAiC;AAC/Bf,MAAAA,oBAAoB,IAAIA,oBAAoB,CAAC,QAAD,CAA5C;AACD,KAFD,MAEO,IAAIe,cAAc,KAAK,SAAvB,EAAkC;AACvCf,MAAAA,oBAAoB,IAAIA,oBAAoB,CAAC,SAAD,CAA5C;AACD,KArCmB,CAsCpB;AACA;AACA;AACA;;AACD,GA1CD,EA0CG,CAACe,cAAD,EAAiBf,oBAAjB,CA1CH;AA4CA9B,EAAAA,KAAK,CAACiD,SAAN,CAAgB,MAAM;AACpB;AACA,QAAID,WAAW,CAACR,OAAZ,KAAwBT,OAAxB,IAAmC,CAACA,OAAxC,EAAiD;AAC/Ce,MAAAA,iBAAiB,CAAC,SAAD,CAAjB;AACD;;AAED,QAAIf,OAAJ,EAAa;AACXe,MAAAA,iBAAiB,CAAC,UAAD,CAAjB;AACD;;AACDE,IAAAA,WAAW,CAACR,OAAZ,GAAsBT,OAAtB,CAToB,CAUpB;AACD,GAXD,EAWG,CAACA,OAAD,CAXH,EA1DG,CAuEH;AAEA;;AACA,QAAM0B,YAAY,GAChBZ,cAAc,KAAK,QAAnB,IAA+BZ,IAA/B,GACI,EAAE,GAAGvB,aAAL;AAAoB,OAAGuB;AAAvB,GADJ,GAEI,EAAE,GAAGvB,aAAL;AAAoB,OAAGI;AAAvB,GAHN,CA1EG,CA8EH;AAEA;AACA;AACA;AACA;;AAEA,QAAM4C,YAAY,GAAG,EAAE,GAAGhD,aAAL;AAAoB,OAAGsB;AAAvB,GAArB,CArFG,CAuFH;AACA;AACA;AACA;AACA;AAEA;;AACA,QAAMhB,MAAM,GAAGhB,KAAK,CAAC0C,OAAN,CAAc,MAAM;AACjC;AACA,WAAO,CACL9B,iBAAiB,CAACC,YAAD,CAAjB,CACE4C,YADF,EAEEC,YAFF,CADK,EAKLxB,KALK,CAAP;AAOD,GATc,EASZ,CAACrB,YAAD,EAAeC,OAAf,EAAwBkB,OAAxB,EAAiCE,KAAjC,CATY,CAAf;AAWA,sBACE,oBAAC,SAAD,CACE;AADF;AAEE,IAAA,aAAa,EAAE,CAACH,OAAD,GAAW,MAAX,GAAoB,UAFrC,CAGE;AACA;AACA;AALF;AAME,IAAA,KAAK,EAAE,CAACf,MAAD,CANT;AAOE,IAAA,GAAG,EAAEqB;AAPP,KAQMD,IARN,GAUGP,QAVH,CADF;AAcD,CArIiC,CAA7B","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { forwardRef } from 'react';\nimport { Animated } from 'react-native';\nimport type {\n  ISupportedTransitions,\n  ITransitionConfig,\n  ITransitionProps,\n} from './types';\n\nconst transformStylesMap = {\n  translateY: true,\n  translateX: true,\n  scale: true,\n  scaleX: true,\n  scaleY: true,\n  rotate: true,\n};\n\nconst defaultStyles = {\n  opacity: 1,\n  translateY: 0,\n  translateX: 0,\n  scale: 1,\n  scaleX: 1,\n  scaleY: 1,\n  rotate: '0deg',\n};\n\nconst getAnimatedStyles = (animateValue: any) => (\n  initial: ISupportedTransitions,\n  to: ISupportedTransitions\n) => {\n  const styles: any = {\n    transform: [],\n  };\n  for (let key in initial) {\n    if (key === 'transition') {\n      continue;\n    }\n\n    if (key in transformStylesMap) {\n      styles.transform?.push({\n        [key]: animateValue.interpolate({\n          inputRange: [0, 1],\n          outputRange: [(initial as any)[key], (to as any)[key]],\n        }),\n      } as any);\n    } else {\n      styles[key] = animateValue.interpolate({\n        inputRange: [0, 1],\n        outputRange: [(initial as any)[key], (to as any)[key]],\n      });\n    }\n  }\n\n  return styles;\n};\n\nconst defaultTransitionConfig: ITransitionConfig = {\n  type: 'timing',\n  useNativeDriver: true,\n  duration: 250,\n  delay: 0,\n};\n\nexport const Transition = forwardRef(\n  (\n    {\n      children,\n      onTransitionComplete,\n      visible = false,\n      initial,\n      animate,\n      exit,\n      style,\n      as,\n      ...rest\n    }: ITransitionProps,\n    ref: any\n  ) => {\n    const animateValue = React.useRef(new Animated.Value(0)).current;\n\n    const Component = React.useMemo(() => {\n      if (as) {\n        return Animated.createAnimatedComponent(as);\n      }\n      return Animated.View;\n    }, [as]);\n\n    const [animationState, setAnimationState] = React.useState('');\n\n    const prevVisible = React.useRef(visible);\n\n    React.useEffect(() => {\n      if (animationState === 'entering' || animationState === 'exiting') {\n        const entryTransition = {\n          ...defaultTransitionConfig,\n          ...animate?.transition,\n        };\n        const exitTransition = {\n          ...defaultTransitionConfig,\n          ...exit?.transition,\n        };\n\n        const startAnimation = animationState === 'entering' ? 1 : 0;\n\n        const transition = startAnimation ? entryTransition : exitTransition;\n\n        Animated.sequence([\n          // @ts-ignore - delay is present in defaultTransitionConfig\n          Animated.delay(transition.delay),\n          Animated[transition.type ?? 'timing'](animateValue, {\n            toValue: startAnimation,\n            useNativeDriver: true,\n            ...transition,\n          }),\n        ]).start(() => {\n          if (animationState === 'entering') {\n            setAnimationState('entered');\n          } else if (animationState === 'exiting') {\n            setAnimationState('exited');\n          }\n        });\n        // });\n      }\n\n      if (animationState === 'exited') {\n        onTransitionComplete && onTransitionComplete('exited');\n      } else if (animationState === 'entered') {\n        onTransitionComplete && onTransitionComplete('entered');\n      }\n      // if (animationState === 'entering') {\n      //   //\n      // }\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [animationState, onTransitionComplete]);\n\n    React.useEffect(() => {\n      // if (!visible) {\n      if (prevVisible.current !== visible && !visible) {\n        setAnimationState('exiting');\n      }\n\n      if (visible) {\n        setAnimationState('entering');\n      }\n      prevVisible.current = visible;\n      // }\n    }, [visible]);\n\n    // If exit animation is present and state is exiting, we replace 'initial' with 'exit' animation\n\n    //  const initialState = { ...defaultStyles, ...initial };\n    const initialState =\n      animationState === 'exited' && exit\n        ? { ...defaultStyles, ...exit }\n        : { ...defaultStyles, ...initial };\n    // const initialState = { ...defaultStyles, ...initial };\n\n    // initial =\n    //   animationState === 'exited'\n    //     ? { ...defaultStyles, ...exit }\n    //     : { ...defaultStyles, ...initial };\n\n    const animateState = { ...defaultStyles, ...animate };\n\n    // const [initialState, setInitialState] = React.useState({\n    //   ...defaultStyles,\n    //   ...initial,\n    // });\n    // console.log('Initial state ', initial);\n\n    // const [animateState] = React.useState({ ...defaultStyles, ...animate });\n    const styles = React.useMemo(() => {\n      // console.log('display state here', initial);\n      return [\n        getAnimatedStyles(animateValue)(\n          initialState as ISupportedTransitions,\n          animateState as ISupportedTransitions\n        ),\n        style,\n      ];\n    }, [animateValue, initial, animate, style]);\n\n    return (\n      <Component\n        // pointerEvents=\"box-none\"\n        pointerEvents={!visible ? 'none' : 'box-none'}\n        // https://github.com/facebook/react-native/issues/23090#issuecomment-710803743\n        // needsOffscreenAlphaCompositing\n        // style={[styles]}\n        style={[styles]}\n        ref={ref}\n        {...rest}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n"]}